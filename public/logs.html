<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.tailwindcss.com"></script>
<title>Logs - Azrova Shield</title>
</head>
<body class="min-h-screen bg-gradient-to-b from-black via-zinc-950 to-black text-gray-100">
<div class="max-w-6xl mx-auto px-4 py-6">
  <div class="flex items-center justify-between mb-6">
    <div class="flex items-center gap-3">
      <div class="h-9 w-9 rounded-lg bg-emerald-600/20 flex items-center justify-center border border-emerald-600/40">
        <svg class="h-5 w-5 text-emerald-400" viewBox="0 0 24 24" fill="none"><path d="M12 3l7 4v6c0 4.418-3.582 8-8 8S3 17.418 3 13V7l9-4z" stroke="currentColor" stroke-width="1.5"/></svg>
      </div>
      <div>
        <div class="text-2xl font-semibold">Azrova Shield</div>
        <div class="text-xs text-zinc-400">Logs</div>
      </div>
    </div>
    <div class="flex items-center gap-3">
      <a href="/dashboard" class="text-sm px-3 py-2 bg-zinc-900/60 border border-zinc-800 rounded hover:bg-zinc-800">Dashboard</a>
    </div>
  </div>

  <div class="bg-zinc-900/70 backdrop-blur border border-zinc-800 rounded-xl p-4 mb-4">
    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
      <div class="flex items-center gap-2">
        <button id="tabSystem" class="px-3 py-2 rounded-lg border border-zinc-700 bg-zinc-800 text-zinc-200">System</button>
        <button id="tabIP" class="px-3 py-2 rounded-lg border border-zinc-800 bg-zinc-900 text-zinc-300">IP</button>
        <button id="tabAccess" class="px-3 py-2 rounded-lg border border-zinc-800 bg-zinc-900 text-zinc-300">Access</button>
      </div>
      <div class="flex items-center gap-2">
        <label class="text-sm text-zinc-400">Limit</label>
        <input id="limit" type="number" min="1" max="5000" value="500" class="w-24 px-3 py-2 rounded bg-zinc-800 border border-zinc-700 outline-none focus:ring-2 focus:ring-emerald-600">
        <button id="refresh" class="px-3 py-2 rounded-lg bg-emerald-600 hover:bg-emerald-500">Refresh</button>
      </div>
    </div>
  </div>

  <div class="bg-zinc-900/70 backdrop-blur border border-zinc-800 rounded-xl overflow-hidden">
    <div class="overflow-x-auto">
      <table class="w-full text-sm">
        <thead class="bg-zinc-900 text-zinc-400">
          <tr>
            <th class="text-left px-4 py-2">Time</th>
            <th class="text-left px-4 py-2">IP</th>
            <th class="text-left px-4 py-2">Method</th>
            <th class="text-left px-4 py-2">Path</th>
            <th class="text-left px-4 py-2">Status</th>
            <th class="text-left px-4 py-2">Action</th>
            <th class="text-left px-4 py-2">Result</th>
          </tr>
        </thead>
        <tbody id="tbody" class="divide-y divide-zinc-800"></tbody>
      </table>
    </div>
  </div>
</div>

<script>
let currentType="system"
let autoTimer=null
function pad(n){return String(n).padStart(2,"0")}
function tsToStr(sec){
  const d=new Date(sec*1000)
  const Y=d.getFullYear()
  const M=pad(d.getMonth()+1)
  const D=pad(d.getDate())
  const h=pad(d.getHours())
  const m=pad(d.getMinutes())
  const s=pad(d.getSeconds())
  return `${Y}-${M}-${D} ${h}:${m}:${s}`
}
function resultFor(action,status){
  const a=(action||"").toLowerCase()
  if(a==="ok"||a==="proxy"||a==="route") return {t:"Entered",c:"text-emerald-400",bg:"bg-emerald-500/10"}
  if(a==="challenge") return {t:"Challenged",c:"text-amber-400",bg:"bg-amber-500/10"}
  if(a==="stealth") return {t:"Stealth",c:"text-zinc-400",bg:"bg-zinc-500/10"}
  if(a==="scrub"||a==="waf_block"||a==="rate_limit"||a==="perm_block"||a==="rule_block"||a==="nginx_temp"||a==="nginx_block") return {t:"Blocked",c:"text-red-400",bg:"bg-red-500/10"}
  if(status>=200&&status<400) return {t:"Entered",c:"text-emerald-400",bg:"bg-emerald-500/10"}
  return {t:"Blocked",c:"text-red-400",bg:"bg-red-500/10"}
}
function row(e){
  const r=resultFor(e.action,e.status)
  const tr=document.createElement("tr")
  const td1=document.createElement("td");td1.className="px-4 py-2 text-zinc-300";td1.textContent=tsToStr(e.ts||0)
  const td2=document.createElement("td");td2.className="px-4 py-2 text-zinc-300";td2.textContent=e.ip||""
  const td3=document.createElement("td");td3.className="px-4 py-2 text-zinc-300";td3.textContent=e.method||""
  const td4=document.createElement("td");td4.className="px-4 py-2 text-zinc-300";td4.textContent=e.path||""
  const td5=document.createElement("td");td5.className="px-4 py-2 text-zinc-300";td5.textContent=String(e.status||0)
  const td6=document.createElement("td");td6.className="px-4 py-2 text-zinc-300";td6.textContent=e.action||""
  const td7=document.createElement("td");td7.className="px-4 py-2";const b=document.createElement("span");b.className=`px-2 py-1 rounded ${r.bg} ${r.c}`;b.textContent=r.t;td7.appendChild(b)
  tr.appendChild(td1);tr.appendChild(td2);tr.appendChild(td3);tr.appendChild(td4);tr.appendChild(td5);tr.appendChild(td6);tr.appendChild(td7)
  return tr
}
async function load(){
  const limit=parseInt(document.getElementById("limit").value||"500",10)
  const url="/api/logs?type="+encodeURIComponent(currentType)+"&limit="+(isNaN(limit)?500:limit)
  const res=await fetch(url,{credentials:"same-origin"})
  if(!res.ok)return
  const arr=await res.json()
  const tb=document.getElementById("tbody")
  tb.innerHTML=""
  arr.forEach(e=>tb.appendChild(row(e)))
}
function setTab(t){
  currentType=t
  document.getElementById("tabSystem").className="px-3 py-2 rounded-lg border "+(t==="system"?"border-zinc-700 bg-zinc-800 text-zinc-200":"border-zinc-800 bg-zinc-900 text-zinc-300")
  document.getElementById("tabIP").className="px-3 py-2 rounded-lg border "+(t==="ip"?"border-zinc-700 bg-zinc-800 text-zinc-200":"border-zinc-800 bg-zinc-900 text-zinc-300")
  document.getElementById("tabAccess").className="px-3 py-2 rounded-lg border "+(t==="access"?"border-zinc-700 bg-zinc-800 text-zinc-200":"border-zinc-800 bg-zinc-900 text-zinc-300")
  load()
}
document.getElementById("tabSystem").addEventListener("click",()=>setTab("system"))
document.getElementById("tabIP").addEventListener("click",()=>setTab("ip"))
document.getElementById("tabAccess").addEventListener("click",()=>setTab("access"))
document.getElementById("refresh").addEventListener("click",()=>load())
setTab("system")
if(autoTimer) clearInterval(autoTimer)
autoTimer=setInterval(load,2000)
</script>
</body>
</html>